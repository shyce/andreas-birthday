<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andrea's Enchanted 39th Birthday</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lora:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root {
            --bg-gradient: radial-gradient(circle at center, #1a0933, #3c096c);
            --text-primary: #f8e3ff;
            --text-secondary: #d8b4e2;
            --accent-color: #ffd700;
            --accent-color-2: #4ecdc4;
            --event-bg: rgba(255, 255, 255, 0.05);
            --event-border: rgba(255, 255, 255, 0.1);
            --completed-opacity: 0.6;
        }

        body {
            font-family: 'Lora', serif;
            line-height: 1.6;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }


        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .title-image {
            width: 80px;
            height: 80px;
            margin-right: 20px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
            animation: float 3s ease-in-out infinite;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            color: var(--accent-color);
            font-size: 2.5em;
            text-align: left;
            margin: 0;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }



        .event {
            background-color: var(--event-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 0 15px rgba(78, 205, 196, 0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--event-border);
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .event::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(78, 205, 196, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .event:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(78, 205, 196, 0.2);
        }

        .event:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 20px rgba(78, 205, 196, 0.2);
        }

        .event h2 {
            color: var(--accent-color);
            margin: 0;
            font-size: 1.8em;
            font-family: 'Playfair Display', serif;
        }

        .event p {
            margin: 10px 0;
            color: var(--text-secondary);
            font-size: 1em;
            line-height: 1.6;
        }

        .event.completed {
            opacity: var(--completed-opacity);
            transition: opacity 0.3s ease;
        }

        .event.completed h2,
        .event.completed p:not(.timer) {
            text-decoration: line-through;
        }

        .event.completed .timer {
            text-decoration: none;
        }

        .venue-info-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .venue-info-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }

        .venue-info-container.show {
            max-height: 1000px;
        }

        .venue-info {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .venue-info h3 {
            color: var(--accent-color);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .venue-info p {
            margin: 5px 0;
        }

        .venue-info a {
            color: var(--accent-color-2);
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        .venue-info a:hover {
            color: var(--accent-color);
        }

        .venue-details h3 {
            color: var(--accent-color);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .venue-details p {
            margin: 5px 0;
            color: var(--text-secondary);
        }

        .timer {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 15px;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .event-time {
            font-size: 1.1em;
            color: var(--accent-color-2);
            font-weight: bold;
            white-space: nowrap;
        }

        .event-description {
            margin-bottom: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .free-time,
        .gift-time {
            background-color: rgba(255, 215, 0, 0.1);
            border-left: 3px solid var(--accent-color);
            padding: 10px;
            margin-top: 10px;
            font-style: italic;
        }

        input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.3);
        }

        label {
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            flex: 1;
        }

        #leaves {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
        }

        .leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            opacity: 0.7;
            transition: opacity 0.5s ease;
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3));
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            margin-top: 40px;
            border-radius: 15px;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 5px;
            background-color: var(--accent-color);
            width: 0;
            transition: width 0.5s ease-in-out;
        }


        .overall-time {
            text-align: center;
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .overall-progress-container {
            margin-bottom: 30px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        #overall-countdown {
            text-align: center;
            font-size: 1.2em;
            color: var(--text-primary);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .overall-progress-bar {
            width: 100%;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        #overall-progress {
            height: 100%;
            background-color: var(--accent-color);
            width: 0;
            transition: width 0.5s ease-in-out;
            position: absolute;
            left: 0;
            top: 0;
            background-image: linear-gradient(45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent);
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }

        @keyframes move {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 50px 50px;
            }
        }

        .toggle-venue-info {
            background-color: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .toggle-venue-info:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        .map-container {
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
        }

        .maps-link {
            color: var(--accent-color-2);
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        .maps-link:hover {
            color: var(--accent-color);
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2.5em;
            }

            .event {
                padding: 20px;
            }

            .toggle-venue-info,
            .toggle-map {
                display: block;
                width: 100%;
                margin-top: 10px;
            }

            .event-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .event-time {
                margin-top: 5px;
            }

            .overall-progress-container {
                padding: 15px;
            }

            #overall-countdown {
                font-size: 1em;
            }

            .title-container {
                flex-direction: column;
                text-align: center;
            }

            .title-image {
                margin-right: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>

<body>
    <div id="leaves"></div>
    <div class="container">
        <div class="title-container">
            <img src="favicon.png" alt="Cupcake" class="title-image">
            <h1>Andrea's Enchanted 39th Birthday</h1>
        </div>
        <div id="overall-countdown"><span id="main-timer"></span></div>
        <div id="events-container">
            <!-- Events will be dynamically added here -->
        </div>
    </div>
    <footer>
        <p>Andrea, as we celebrate another year together, I can't help but reflect on our amazing journey since that
            night at Wild Bull. From our early adventures to raising our incredible son Gabriel, you've been the light
            of my life. Our love continues to grow stronger, filling our days with laughter and joy. Here's to you, the
            heart of our family, and all the beautiful moments still ahead.</p>
    </footer>
    <script src="https://unpkg.com/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.11.10/plugin/duration.js"></script>
    <script src="https://unpkg.com/dayjs@1.11.10/plugin/relativeTime.js"></script>
    <script>
        const events = [
            {
                startTime: '2024-09-21T09:00:00',
                endTime: '2024-09-21T10:30:00',
                title: `Autumn Sunrise Breakfast at Caffè Casa`,
                description: `We'll kick off your special day with a warm and cozy breakfast at Caffè Casa, a charming spot in Kalamazoo Mall. Picture us nestled in a corner, enjoying the aroma of freshly brewed coffee and your favorite pastries as the autumn sun begins to illuminate the city.`,
                freeTime: `After breakfast, we'll take a leisurely 12-minute stroll (0.6 mile) to our next destination. We'll walk via E Michigan Ave, giving us a chance to admire the early morning ambiance of downtown Kalamazoo.`,
                venueInfo: {
                    name: `Caffè Casa`,
                    address: `128 S Kalamazoo Mall, Kalamazoo, MI 49007`,
                    phone: `(269) 385-1026`,
                }
            },
            {
                startTime: '2024-09-21T11:00:00',
                endTime: '2024-09-21T13:00:00',
                title: `Fall Fashion Exploration in Downtown Kalamazoo`,
                description: `We'll stroll through the charming boutiques in downtown Kalamazoo. As we wander hand in hand, we'll take our time trying on cozy sweaters and browsing for that perfect scarf to complement the fall colors.`,
                giftTime: `I've set aside a special budget for you to choose a new fall outfit as a birthday treat!`,
                venueInfo: {
                    name: `Kalamazoo Mall`,
                    address: `South Kalamazoo Mall, Kalamazoo, MI 49007`,
                }
            },
            {
                startTime: '2024-09-21T13:30:00',
                endTime: '2024-09-21T15:00:00',
                title: `Lunch at 600 Kitchen & Bar`,
                description: `We'll settle in for a romantic lunch at 600 Kitchen & Bar, known for its creative seasonal menu and inviting atmosphere. We can reminisce about our journey together over delicious dishes and toast to the moments that brought us here.`,
                venueInfo: {
                    name: `600 Kitchen & Bar`,
                    address: `600 E Michigan Ave, Kalamazoo, MI 49007`,
                    phone: `(269) 443-2401`,
                }
            },
            {
                startTime: '2024-09-21T15:30:00',
                endTime: '2024-09-21T17:30:00',
                title: `Relaxing Spa Retreat at Centre Spa`,
                description: `You deserve some pampering, so we'll head to Centre Spa for a well-deserved retreat. I've arranged for a soothing deep tissue massage, allowing you to unwind and let go of any stress.`,
                giftTime: `In addition to the massage, I'll be driving you around and getting you anything you need!`,
                venueInfo: {
                    name: `Centre Spa`,
                    address: `1429 W Main St, Kalamazoo, MI 49006`,
                    phone: `(269) 342-4441`,
                }
            },
            {
                startTime: '2024-09-21T18:00:00',
                endTime: '2024-09-21T20:00:00',
                title: `Candlelit Dinner at Rustica`,
                description: `As the sun begins to set, we'll head to Rustica for an intimate dinner by candlelight. This cozy restaurant is perfect for us to share a meal filled with rich flavors and heartwarming conversation. I'll have a special dessert planned to surprise you, making this moment even sweeter.`,
                giftTime: `I have a special gift to present to you during our dinner.`,
                venueInfo: {
                    name: `Rustica`,
                    address: `236 S Kalamazoo Mall, Kalamazoo, MI 49007`,
                    phone: `(269) 492-0247`,
                }
            },
            {
                startTime: '2024-09-21T20:30:00',
                endTime: '2024-09-22T02:00:00', // Extended to 2 AM the next day
                title: `Harvest Moon Dance at Wild Bull`,
                description: `Finally, we'll dance the night away at Wild Bull, where our story began. The energy will be electric as we celebrate at the Harvest Moon Party, and just when we think the night can't get any better, we'll enjoy the late-night pizza buffet—no waiting in line!`,
                freeTime: `Take breaks between dances to enjoy the outdoor patio and re-live memories of when we met.`,
                venueInfo: {
                    name: `Wild Bull Saloon & Steakpit`,
                    address: `139 S Edwards St, Kalamazoo, MI 49007`,
                    phone: `(269) 978-8451`,
                }
            },
            {
                startTime: '2024-09-22T02:00:00',
                endTime: '2024-09-22T02:30:00',
                title: `Safe Ride Home`,
                description: `After an amazing night of celebration, it's time for a safe journey home. I'll arrange for a reliable ride to ensure we end the night responsibly.`,
                venueInfo: {
                    name: `Uber Pickup Point`,
                    address: `139 S Edwards St, Kalamazoo, MI 49007`,
                }
            }
        ];

        const LEAF_COUNT = 75;
        const leafPool = [];

        function manageLeafPool() {
            leafPool.forEach(leaf => {
                if (leaf.isOffScreen()) {
                    leaf.reset();
                }
            });
        }

        class Leaf {
            constructor() {
                this.element = this.createLeafElement();
                this.leafColors = [
                    '#4CAF50', '#69C550', '#86DB50', '#A3F150', '#C1F33C', '#DFF528',
                    '#FDF714', '#FDE014', '#FDC914', '#FDB214', '#FD9B14', '#FD8414',
                    '#FD6D14', '#FD5614', '#FD3F14', '#FD2814', '#E82C14', '#D33014'
                ];
                this.reset(true);
            }

            createLeafElement() {
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.setAttribute("viewBox", "0 0 24 24");
                svg.style.position = 'absolute';
                svg.style.width = '20px';
                svg.style.height = '20px';

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", "M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z");

                svg.appendChild(path);
                document.getElementById('leaves').appendChild(svg);

                return svg;
            }

            reset(isInitial = false) {
                this.element.style.left = `${Math.random() * 100}vw`;
                this.element.style.top = '-20px';
                this.startTime = null;
                this.animationDuration = Math.random() * 15 + 20; // 20-35 seconds
                this.colorTransitionSpeed = Math.random() * 0.5 + 0.75;
                this.swayFactor = Math.random() * 100 + 50;
                this.rotationSpeed = Math.random() * 720 + 360;
                this.fallCurve = Math.random() * 0.3 + 0.7;
                this.initialDelay = isInitial ? Math.random() * 14000 + 1000 : 0; // 1-15 seconds for initial leaves, 0 for resets

                // Reset color to initial green
                this.element.querySelector('path').setAttribute('fill', this.leafColors[0]);

                this.startAnimation();
            }

            startAnimation() {
                const animate = (timestamp) => {
                    if (!this.startTime) this.startTime = timestamp;
                    let elapsed = timestamp - this.startTime;

                    if (elapsed < this.initialDelay) {
                        requestAnimationFrame(animate);
                        return;
                    }

                    let progress = (elapsed - this.initialDelay) / (this.animationDuration * 1000);

                    if (progress < 1) {
                        const adjustedProgress = Math.pow(progress, this.fallCurve);
                        const translateY = adjustedProgress * (window.innerHeight + 40);
                        const translateX = Math.sin(adjustedProgress * 4 * Math.PI) * this.swayFactor;
                        const rotate = adjustedProgress * this.rotationSpeed;

                        // Color transition
                        const colorProgress = progress * this.colorTransitionSpeed * (this.leafColors.length - 1);
                        const currentColorIndex = Math.floor(colorProgress);
                        const nextColorIndex = Math.min(currentColorIndex + 1, this.leafColors.length - 1);
                        const colorInterpolation = colorProgress % 1;

                        const currentColor = this.leafColors[currentColorIndex];
                        const nextColor = this.leafColors[nextColorIndex];
                        const interpolatedColor = this.interpolateColor(currentColor, nextColor, colorInterpolation);

                        this.element.querySelector('path').setAttribute('fill', interpolatedColor);
                        this.element.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${rotate}deg)`;

                        requestAnimationFrame(animate);
                    } else {
                        this.reset();
                    }
                };

                requestAnimationFrame(animate);
            }

            isOffScreen() {
                const rect = this.element.getBoundingClientRect();
                return rect.top > window.innerHeight;
            }

            interpolateColor(color1, color2, factor) {
                if (!color1 || !color2) return color1 || color2 || '#4CAF50'; // Fallback to initial green if colors are undefined

                const r1 = parseInt(color1.substring(1, 3), 16);
                const g1 = parseInt(color1.substring(3, 5), 16);
                const b1 = parseInt(color1.substring(5, 7), 16);

                const r2 = parseInt(color2.substring(1, 3), 16);
                const g2 = parseInt(color2.substring(3, 5), 16);
                const b2 = parseInt(color2.substring(5, 7), 16);

                const r = Math.round(r1 + factor * (r2 - r1));
                const g = Math.round(g1 + factor * (g2 - g1));
                const b = Math.round(b1 + factor * (b2 - b1));

                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
            }
        }

        function createEventElement(event, index) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'event';

            const startTime = dayjs(event.startTime).format('h:mm A');
            const endTime = dayjs(event.endTime).format('h:mm A');

            let venueInfoHtml = '';
            if (event.venueInfo) {
                venueInfoHtml = `
            <div class="venue-info">
                <div class="venue-details">
                    <h3>${event.venueInfo.name}</h3>
                    <p>${event.venueInfo.address}</p>
                    ${event.venueInfo.phone ? `<p>${event.venueInfo.phone}</p>` : ''}
                </div>
                <div class="map-container">
                    <iframe
                        width="100%"
                        height="200"
                        frameborder="0" style="border:0"
                        src="https://www.google.com/maps/embed/v1/place?key=AIzaSyAIBxVePUhcqoZz4-H3kKqcDuvHLHqdyUY&q=${encodeURIComponent(event.venueInfo.address)}" 
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        `;
            }

            eventDiv.innerHTML = `
        <div class="event-header">
            <h2>${event.title}</h2>
            <p class="event-time">${startTime} - ${endTime}</p>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-${index}"></div>
        </div>
        <p class="event-description">${event.description}</p>
        ${event.freeTime ? `<p class="free-time">${event.freeTime}</p>` : ''}
        ${event.giftTime ? `<p class="gift-time">${event.giftTime}</p>` : ''}
        <button class="toggle-venue-info">
            <span class="venue-info-text">Venue Information</span>
            <span class="venue-info-icon">▼</span>
        </button>
        <div class="venue-info-container">
            ${venueInfoHtml}
        </div>
        <p class="timer" id="timer-${index}"></p>
    `;

            const toggleVenueBtn = eventDiv.querySelector('.toggle-venue-info');
            const venueInfoContainer = eventDiv.querySelector('.venue-info-container');
            const venueInfoIcon = eventDiv.querySelector('.venue-info-icon');

            toggleVenueBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                venueInfoContainer.classList.toggle('show');
                venueInfoIcon.textContent = venueInfoContainer.classList.contains('show') ? '▲' : '▼';
            });

            return eventDiv;
        }

        function updateProgressBars() {
            const now = dayjs();
            events.forEach((event, index) => {
                const startTime = dayjs(event.startTime);
                const endTime = dayjs(event.endTime);
                const progressBar = document.getElementById(`progress-${index}`);

                if (now.isBefore(startTime)) {
                    progressBar.style.width = '0%';
                } else if (now.isAfter(endTime)) {
                    progressBar.style.width = '100%';
                } else {
                    const totalDuration = endTime.diff(startTime);
                    const elapsed = now.diff(startTime);
                    const percentage = (elapsed / totalDuration) * 100;
                    progressBar.style.width = `${percentage}%`;
                }
            });

            // Update overall progress bar
            const overallProgress = document.getElementById('overall-progress');
            const firstEventStart = dayjs(events[0].startTime);
            const lastEventEnd = dayjs(events[events.length - 1].endTime);
            const totalDuration = lastEventEnd.diff(firstEventStart);
            const elapsed = now.diff(firstEventStart);
            const overallPercentage = Math.max(0, Math.min(100, (elapsed / totalDuration) * 100));
            overallProgress.style.width = `${overallPercentage}%`;
        }

        // Add this function to calculate the overall progress
        function calculateOverallProgress() {
            const now = dayjs();
            const firstEventStart = dayjs(events[0].startTime);
            const lastEventEnd = dayjs(events[events.length - 1].endTime);

            if (now.isBefore(firstEventStart)) {
                // Before the day begins, progress should be 0%
                return 0;
            } else if (now.isAfter(lastEventEnd)) {
                // After the day is over, progress should be 100%
                return 100;
            } else {
                // During the day, calculate actual progress
                const totalDuration = lastEventEnd.diff(firstEventStart);
                const elapsed = now.diff(firstEventStart);
                return Math.max(0, Math.min(100, (elapsed / totalDuration) * 100));
            }
        }

        function updateOverallCountdown() {
            const now = dayjs();
            const surpriseAnnouncement = dayjs('2024-09-19T04:20:00'); // Replace with the actual date you told her
            const eventDay = dayjs(events[0].startTime).startOf('day');
            const firstEventStart = dayjs(events[0].startTime);
            const lastEventEnd = dayjs(events[events.length - 1].endTime);
            const overallCountdown = document.getElementById('overall-countdown');
            const overallProgress = document.getElementById('overall-progress');

            if (now.isBefore(eventDay)) {
                // Progress from surprise announcement to event day
                const totalWaitDuration = eventDay.diff(surpriseAnnouncement);
                const elapsedWait = now.diff(surpriseAnnouncement);
                const waitProgress = Math.min(100, (elapsedWait / totalWaitDuration) * 100);

                const remainingDuration = dayjs.duration(eventDay.diff(now));
                const days = remainingDuration.days();
                const hours = remainingDuration.hours();
                const minutes = remainingDuration.minutes();
                const seconds = remainingDuration.seconds();

                overallCountdown.innerHTML = `Time until Andrea's special day: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                overallProgress.style.width = `${waitProgress}%`;
            } else if (now.isBefore(lastEventEnd)) {
                // During the day of the events
                const totalEventDuration = lastEventEnd.diff(firstEventStart);
                const elapsedEventTime = now.diff(firstEventStart);
                const eventProgress = Math.min(100, (elapsedEventTime / totalEventDuration) * 100);

                overallCountdown.innerHTML = "Andrea, I love you with all my heart and hope this day is everything.";
                overallProgress.style.width = `${eventProgress}%`;
            } else {
                // After all events have ended
                overallCountdown.innerHTML = "Good night, beautiful.";
                overallProgress.style.width = '100%';
            }
        }

        dayjs.extend(dayjs_plugin_duration);
        dayjs.extend(dayjs_plugin_relativeTime);

        function formatTimeRemaining(distance) {
            const duration = dayjs.duration(distance);
            const days = Math.floor(duration.asDays());
            const hours = Math.floor(duration.hours());
            const minutes = Math.floor(duration.minutes());
            const seconds = Math.floor(duration.seconds());

            let timeString = [];
            if (days > 0) {
                timeString.push(`${days} day${days > 1 ? 's' : ''}`);
            }
            if (hours > 0) {
                timeString.push(`${hours} hour${hours > 1 ? 's' : ''}`);
            }
            if (minutes > 0) {
                timeString.push(`${minutes} minute${minutes > 1 ? 's' : ''}`);
            }
            if (seconds > 0) {
                timeString.push(`${seconds} second${seconds > 1 ? 's' : ''}`);
            }

            return timeString.join(', ');
        }

        function updateTimers() {
            const now = dayjs();
            const eventElements = document.querySelectorAll('.event');

            eventElements.forEach((eventElement, index) => {
                const event = events[index];
                const eventStartTime = dayjs(event.startTime);
                const eventEndTime = dayjs(event.endTime);
                const distanceToStart = eventStartTime.diff(now);
                const distanceToEnd = eventEndTime.diff(now);

                const timerElement = eventElement.querySelector('.timer');
                const toggleVenueBtn = eventElement.querySelector('.toggle-venue-info');
                const progressBar = eventElement.querySelector('.progress-bar');

                if (timerElement) {
                    if (distanceToEnd < 0) {
                        timerElement.innerHTML = 'This magical moment has passed!';
                        if (toggleVenueBtn && !toggleVenueBtn.disabled) {
                            toggleVenueBtn.disabled = true;
                            eventElement.classList.add('completed');
                        }
                        progressBar.style.width = '100%';
                    } else if (distanceToStart < 0) {
                        timerElement.innerHTML = `In progress! Ends in ${formatTimeRemaining(distanceToEnd)}`;
                        const totalDuration = eventEndTime.diff(eventStartTime);
                        const elapsed = now.diff(eventStartTime);
                        const percentage = (elapsed / totalDuration) * 100;
                        progressBar.style.width = `${percentage}%`;
                    } else {
                        timerElement.innerHTML = `Begins in ${formatTimeRemaining(distanceToStart)}`;
                        progressBar.style.width = '0%';
                    }
                }
            });

            updateOverallCountdown();
        }

        function checkPastEvents() {
            const now = dayjs();
            events.forEach((event, index) => {
                const eventEndTime = dayjs(event.endTime);
                if (now.isAfter(eventEndTime)) {
                    const checkbox = document.getElementById(`event-${index}`);
                    if (checkbox && !checkbox.checked) {
                        checkbox.checked = true;
                        checkbox.disabled = true;
                        toggleComplete(index);
                    }
                }
            });
        }

        function toggleComplete(index) {
            const eventElement = document.getElementById(`event-${index}`).closest('.event');
            eventElement.classList.toggle('completed');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Initial leaf creation
            for (let i = 0; i < LEAF_COUNT; i++) {
                leafPool.push(new Leaf());
            }

            // Set up the leaf management interval
            setInterval(manageLeafPool, 100);

            const container = document.getElementById('events-container');
            events.forEach((event, index) => {
                container.appendChild(createEventElement(event, index));
            });

            // Add overall progress bar and countdown
            const overallProgressContainer = document.createElement('div');
            overallProgressContainer.className = 'overall-progress-container';
            overallProgressContainer.innerHTML = `
                <div id="overall-countdown"></div>
                <div class="overall-progress-bar">
                    <div id="overall-progress"></div>
                </div>
            `;
            document.querySelector('.container').insertBefore(overallProgressContainer, document.getElementById('events-container'));

            // Initial update
            updateTimers();
            updateOverallCountdown();

            // Set up regular updates
            setInterval(() => {
                updateTimers();
                updateOverallCountdown();
            }, 1000); // Update every second
        });
    </script>
</body>

</html>